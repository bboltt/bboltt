# %%capture
!pip -q install --upgrade openai

import os
from getpass import getpass
from openai import OpenAI

# 1) Set your API key (input is hidden in Colab).
if not os.getenv("OPENAI_API_KEY"):
    os.environ["OPENAI_API_KEY"] = getpass("OpenAI API key: ")

client = OpenAI()

# 2) Pick the model.
# chatgpt-4o-latest auto-tracks the GPT-4o version used by ChatGPT.
# If you have access and want the newest flagship instead, try "gpt-5-chat-latest".
MODEL = "chatgpt-4o-latest"

# 3) Tiny dialogue bot.
def chat(msg, history=None, model=MODEL, temperature=0.2):
    messages = (history[:] if history else []) + [{"role":"user","content":msg}]
    resp = client.chat.completions.create(model=model, messages=messages, temperature=temperature)
    text = resp.choices[0].message.content
    usage = resp.usage
    return text, messages + [{"role":"assistant","content":text}], usage

# 4) Quick connectivity check.
reply, hist, usage = chat("Reply with exactly: connected.")
print("Model:", MODEL)
print("Reply:", reply)
print("Total tokens:", usage.total_tokens if usage else "n/a")

# 5) Optional REPL: uncomment to chat interactively.
# history = []
# while True:
#     q = input("You: ").strip()
#     if q.lower() in {"exit","quit"}: break
#     a, history, _ = chat(q, history)
#     print("Bot:", a)

